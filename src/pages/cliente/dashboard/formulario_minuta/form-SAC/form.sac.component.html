<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<div class="form-card">
  
  
    
  <!-- Formulario habilitado -->
  <div *ngIf="mostrarFormulario && nombreEmpresa && !formularioEnviado && !mostrandoResumen && !pago2"  class="form-enabled">
    
    <!-- Pasos del formulario -->
    <div class="form-steps">
      <div class="step" *ngFor="let step of pasos; let i = index" 
          [ngClass]="{'active': pasoActual === i, 'completed': pasoActual > i}">
        {{i + 1}}
      </div>
    </div>
    
    <!-- Contenido del paso actual -->
    <div class="step-content" [ngSwitch]="pasoActual">
      
      <!-- Paso 1: Datos Personales -->
      <div *ngSwitchCase="0">
        <h3>Datos Personales</h3>
        <div class="form-group">
          <label>Nacionalidad <span class="required">*</span></label>
          <input type="text" [(ngModel)]="formularioSAC.paso_1.nacionalidad" placeholder="Ingrese su nacionalidad">
        </div>
        <div class="form-group">
          <label>Profesión <span class="required">*</span></label>
          <input type="text" [(ngModel)]="formularioSAC.paso_1.profesion" placeholder="Ingrese su profesión">
        </div>
        <div class="form-group">
          <label>Estado Civil <span class="required">*</span></label>
          <select [(ngModel)]="formularioSAC.paso_1.estado_civil">
            <option value="">Seleccione una opción</option>
            <option value="soltero">Soltero/a</option>
            <option value="casado">Casado/a</option>
            <option value="divorciado">Divorciado/a</option>
            <option value="viudo">Viudo/a</option>
          </select>
        </div>
        <!-- Campos condicionales para cónyuge -->
        <div *ngIf="formularioSAC.paso_1.estado_civil === 'casado'">
          <div class="form-group">
            <label>Nombre del Cónyuge</label>
            <input type="text" [(ngModel)]="formularioSAC.paso_1.nombre_conyuge" placeholder="Ingrese el nombre de su cónyuge">
          </div>
          <div class="form-group">
            <label>DNI del Cónyuge</label>
            <input type="text" [(ngModel)]="formularioSAC.paso_1.dni_conyuge" placeholder="Ingrese el DNI de su cónyuge">
          </div>
        </div>
        <div class="form-group">
          <label>Dirección</label>
          <input type="text" [(ngModel)]="formularioSAC.paso_1.direccion" placeholder="Ingrese su dirección">
        </div>
      </div>
      
      <!-- Paso 2: Datos de la Empresa -->
      <div *ngSwitchCase="1">
        <h3>Datos de la Empresa</h3>
        <div class="form-group">
          <label>Nombre de la Empresa <span class="required">*</span></label>
          <input type="text" [(ngModel)]="formularioSAC.paso_2.nombre_empresa" [readonly]="nombreEmpresa">
        </div>
        <div class="form-group">
          <label>Dirección de la Empresa</label>
          <input type="text" [(ngModel)]="formularioSAC.paso_2.direccion_empresa" placeholder="Ingrese la dirección de la empresa">
        </div>
        <div class="form-group">
          <label>Provincia</label>
          <input type="text" [(ngModel)]="formularioSAC.paso_2.provincia_empresa" placeholder="Ingrese la provincia">
        </div>
        <div class="form-group">
          <label>Departamento</label>
          <input type="text" [(ngModel)]="formularioSAC.paso_2.departamento_empresa" placeholder="Ingrese el departamento">
        </div>
        <div class="form-group">
          <label>Objetivo de la Empresa <span class="required">*</span></label>
          <textarea [(ngModel)]="formularioSAC.paso_2.objetivo" rows="4" placeholder="Describa el objetivo principal de la empresa"></textarea>
        </div>
      </div>
      
      <!-- Paso 3: Socios -->
      <div *ngSwitchCase="2">
        <h3>Socios</h3>
        <div class="info-message">
          <p><i class="fa fa-info-circle"></i>Puedes agregar hasta 3 socios.</p>
          <p><i class="fa fa-warning"></i> El capital total (suma de todos los aportes) no puede exceder {{CAPITAL_MAXIMO | currency:'PEN ':'symbol':'1.2-2'}}.</p>
        </div>
        
        <div class="socios-list">
          <div class="socio-item" *ngFor="let socio of formularioSAC.paso_3; let i = index">
            <div class="socio-header">
              <h4>Socio {{i + 1}}</h4>
              <button class="btn-remove" *ngIf="formularioSAC.paso_3.length > 2" (click)="eliminarSocio(i)">
                Eliminar Socio
              </button>
            </div>
            
            <div class="form-group">
              <label>Nombre del Socio <span class="required">*</span></label>
              <input type="text" [(ngModel)]="socio.nombre_socio" placeholder="Ingrese el nombre del socio">
            </div>
            <div class="form-group">
              <label>Nacionalidad <span class="required">*</span></label>
              <input type="text" [(ngModel)]="socio.nacionalidad_socio" placeholder="Ingrese la nacionalidad">
            </div>
            <div class="form-group">
              <label>DNI <span class="required">*</span></label>
              <input type="text" [(ngModel)]="socio.dni_socio" placeholder="Ingrese el DNI">
            </div>
            <div class="form-group">
              <label>Profesión <span class="required">*</span></label>
              <input type="text" [(ngModel)]="socio.profesion_socio" placeholder="Ingrese la profesión">
            </div>
            <div class="form-group">
              <label>Estado Civil <span class="required">*</span></label>
              <select [(ngModel)]="socio.estado_civil_socio">
                <option value="">Seleccione una opción</option>
                <option value="soltero">Soltero/a</option>
                <option value="casado">Casado/a</option>
                <option value="divorciado">Divorciado/a</option>
                <option value="viudo">Viudo/a</option>
              </select>
            </div>
            
            <!-- Campos condicionales para cónyuge del socio -->
            <div *ngIf="socio.estado_civil_socio === 'casado'">
              <div class="form-group">
                <label>Nombre del Cónyuge</label>
                <input type="text" [(ngModel)]="socio.nombre_conyuge_socio" placeholder="Ingrese el nombre del cónyuge">
              </div>
              <div class="form-group">
                <label>DNI del Cónyuge</label>
                <input type="text" [(ngModel)]="socio.dni_conyuge_socio" placeholder="Ingrese el DNI del cónyuge">
              </div>
            </div>
            
            <!-- Aportes del socio -->
            <div class="aportes-socio">
              <h5>Aportes del Socio {{i + 1}}</h5>
              <div class="aporte-item" *ngFor="let aporte of socio.aportes; let j = index">
                <div class="form-group">
                  <label>Descripción del Aporte</label>
                  <input type="text" 
                         [(ngModel)]="aporte.descripcion" 
                         placeholder="Describa el aporte"
                         [readonly]="tipoFormularioSeleccionado === tiposFormulario.SACBD">
                </div>
                <div class="form-group">
                  <label>Valor del Aporte</label>
                  <input type="number" 
                         [(ngModel)]="aporte.monto" 
                         (ngModelChange)="onAporteSocioChange(i, j, $event)"
                         placeholder="Ingrese el valor del aporte"
                         
                         [max]="CAPITAL_MAXIMO">
                </div>
                <button class="btn-remove-small" *ngIf="socio.aportes.length > 1" (click)="eliminarAporteSocio(i, j)">
                  Eliminar
                </button>
              </div>
              <button class="btn-add-small" (click)="agregarAporteSocio(i)">
                Agregar Aporte
              </button>
            </div>
          </div>
        </div>
        
        <button class="btn-add" (click)="agregarSocio()" [disabled]="formularioSAC.paso_3.length >= 3">
          Agregar Socio
        </button>
      </div>
      
      <!-- Paso 4: Capital y Aportes -->
      <div *ngSwitchCase="3">
        <h3>Capital y Aportes</h3>
        
        <!-- Campo de capital calculado automáticamente -->
        <div class="form-group">
          <label>Monto de Capital Total <span class="required">*</span></label>
          <input type="number" 
                 [value]="calcularCapitalTotal()" 
                 readonly 
                 class="readonly-field"
                 placeholder="Se calcula automáticamente">
          <small class="help-text">Este monto se calcula automáticamente como la suma de todos los aportes de socios y titular.</small>
          <small class="help-text" *ngIf="calcularCapitalTotal() >= CAPITAL_MAXIMO" class="warning-text">
            ⚠️ Se ha alcanzado el límite máximo de {{CAPITAL_MAXIMO | currency:'PEN ':'symbol':'1.2-2'}}
          </small>
        </div>
        
        <!-- Mensaje informativo según el tipo de formulario -->
        <div class="info-message" *ngIf="tipoFormularioSeleccionado === tiposFormulario.SACBD">
          <p><i class="fa fa-info-circle"></i> Para SAC con bienes dinerarios, el aporte debe ser exclusivamente en dinero en efectivo.</p>
          <p><i class="fa fa-warning"></i> El capital máximo permitido es {{CAPITAL_MAXIMO | currency:'PEN ':'symbol':'1.2-2'}}.</p>
        </div>
        <div class="info-message" *ngIf="tipoFormularioSeleccionado === tiposFormulario.SACBND">
          <p><i class="fa fa-info-circle"></i> Para SAC con bienes no dinerarios, puede agregar múltiples aportes de diferentes tipos.</p>
          <p><i class="fa fa-warning"></i> El capital máximo permitido es {{CAPITAL_MAXIMO | currency:'PEN ':'symbol':'1.2-2'}}.</p>
        </div>
        
        <div class="aportes-list">
          <div class="aporte-item" *ngFor="let aporte of formularioSAC.paso_4.aportes; let i = index">
            <div class="form-group">
              <label>Descripción del Aporte <span class="required">*</span></label>
              <input type="text" [(ngModel)]="aporte.descripcion" placeholder="Describa el aporte" 
                [readonly]="tipoFormularioSeleccionado === tiposFormulario.SACBD">
            </div>
            <div class="form-group">
              <label>Valor del Aporte <span class="required">*</span></label>
              <input type="number" 
                     [(ngModel)]="aporte.monto" 
                     (ngModelChange)="onAporteTitularChange(i, $event)"
                     placeholder="Ingrese el valor del aporte"
                     min="0"
                     [max]="CAPITAL_MAXIMO">
            </div>
            <button class="btn-remove" *ngIf="formularioSAC.paso_4.aportes.length > 1" (click)="eliminarAporte(i)">
              Eliminar
            </button>
          </div>
        </div>
        <button class="btn-add" (click)="agregarAporte()" 
                [disabled]="(tipoFormularioSeleccionado === tiposFormulario.SACBD && formularioSAC.paso_4.aportes.length >= 1) || calcularCapitalTotal() >= CAPITAL_MAXIMO">
          Agregar Aporte
        </button>
        
        <!-- Mostrar total actual -->
        <div class="capital-summary">
          <p><strong>Capital Total Actual: {{calcularCapitalTotal() | currency:'PEN ':'symbol':'1.2-2'}}</strong></p>
          <p *ngIf="calcularCapitalTotal() < CAPITAL_MAXIMO">Disponible: {{(CAPITAL_MAXIMO - calcularCapitalTotal()) | currency:'PEN ':'symbol':'1.2-2'}}</p>
        </div>
      </div>
      
      <!-- Paso 5: Apoderado -->
      <div *ngSwitchCase="4">
        <h3>Datos del Apoderado</h3>
        <div class="form-group">
          <label>Nombre del Apoderado <span class="required">*</span></label>
          <input type="text" [(ngModel)]="formularioSAC.paso_5.apoderado" placeholder="Ingrese el nombre del apoderado">
        </div>
        <div class="form-group">
          <label>DNI del Apoderado <span class="required">*</span></label>
          <input type="text" [(ngModel)]="formularioSAC.paso_5.dni_apoderado" placeholder="Ingrese el DNI del apoderado">
        </div>
      </div>
      
      <!-- Paso 6: Confirmación -->
      <div *ngSwitchCase="5">
        <h3>Confirmación</h3>
        <div class="form-group">
          <label>Ciudad <span class="required">*</span></label>
          <input type="text" [(ngModel)]="formularioSAC.paso_6.ciudad" placeholder="Ingrese la ciudad">
        </div>
        <div class="form-group">
          <label>Fecha de Registro</label>
          <input type="date" [(ngModel)]="formularioSAC.paso_6.fecha_registro">
        </div>
        <div class="confirmation-message">
          <p>Por favor revise cuidadosamente toda la información antes de finalizar.</p>
          <p>Al hacer clic en "Finalizar", confirma que todos los datos proporcionados son correctos.</p>
        </div>
      </div>
    </div>
    
    <!-- Navegación entre pasos -->
    <div class="form-navigation">
      <button *ngIf="pasoActual > 0" class="btn-prev" (click)="pasoAnterior()">Anterior</button>
      <button *ngIf="pasoActual < pasos.length - 1" class="btn-next" (click)="pasoSiguiente()">Siguiente</button>
      <button *ngIf="pasoActual === pasos.length - 1" class="btn-submit" (click)="mostrarResumen()">Finalizar</button>
    </div>
  </div>
  
  

  <!-- Resumen del formulario -->
  <div *ngIf="nombreEmpresa && mostrandoResumen && !formularioEnviado" class="form-summary">
    <h3>Resumen de la Información</h3>
    <div class="summary-content">
      <div class="summary-section">
        <h4>Tipo de Empresa</h4>
        <p><strong>Tipo:</strong> {{tipoFormularioSeleccionado === tiposFormulario.SACBD ? 'SAC con Bienes Dinerarios' : 'SAC con Bienes No Dinerarios'}}</p>
      </div>
      
      <div class="summary-section">
        <h4>Datos Personales</h4>
        <p><strong>Nacionalidad:</strong> {{formularioSAC.paso_1.nacionalidad}}</p>
        <p *ngIf="formularioSAC.paso_1.profesion"><strong>Profesión:</strong> {{formularioSAC.paso_1.profesion}}</p>
        <p *ngIf="formularioSAC.paso_1.estado_civil"><strong>Estado Civil:</strong> {{formularioSAC.paso_1.estado_civil}}</p>
        <p *ngIf="formularioSAC.paso_1.direccion"><strong>Dirección:</strong> {{formularioSAC.paso_1.direccion}}</p>
        <div *ngIf="formularioSAC.paso_1.estado_civil === 'casado'">
          <p><strong>Nombre del Cónyuge:</strong> {{formularioSAC.paso_1.nombre_conyuge}}</p>
          <p><strong>DNI del Cónyuge:</strong> {{formularioSAC.paso_1.dni_conyuge}}</p>
        </div>
      </div>
      
      <div class="summary-section">
        <h4>Datos de la Empresa</h4>
        <p><strong>Nombre de la Empresa:</strong> {{nombreEmpresa}}</p>
        <p *ngIf="formularioSAC.paso_2.direccion_empresa"><strong>Dirección:</strong> {{formularioSAC.paso_2.direccion_empresa}}</p>
        <p *ngIf="formularioSAC.paso_2.provincia_empresa"><strong>Provincia:</strong> {{formularioSAC.paso_2.provincia_empresa}}</p>
        <p *ngIf="formularioSAC.paso_2.departamento_empresa"><strong>Departamento:</strong> {{formularioSAC.paso_2.departamento_empresa}}</p>
        <p><strong>Objetivo:</strong> {{formularioSAC.paso_2.objetivo}}</p>
      </div>
      
      <div class="summary-section">
        <h4>Socios</h4>
        <div *ngFor="let socio of formularioSAC.paso_3; let i = index" class="socio-summary">
          <h5>Socio {{i + 1}}</h5>
          <p><strong>Nombre:</strong> {{socio.nombre_socio}}</p>
          <p><strong>DNI:</strong> {{socio.dni_socio}}</p>
          <p><strong>Nacionalidad:</strong> {{socio.nacionalidad_socio}}</p>
          <p><strong>Profesión:</strong> {{socio.profesion_socio}}</p>
          <p><strong>Estado Civil:</strong> {{socio.estado_civil_socio}}</p>
          <div *ngIf="socio.estado_civil_socio === 'casado'">
            <p><strong>Cónyuge:</strong> {{socio.nombre_conyuge_socio}} ({{socio.dni_conyuge_socio}})</p>
          </div>
          <div *ngIf="socio.aportes.length > 0">
            <p><strong>Aportes:</strong></p>
            <ul>
              <li *ngFor="let aporte of socio.aportes">
                {{aporte.descripcion}} - {{aporte.monto | currency:'PEN ':'symbol':'1.2-2'}}
              </li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="summary-section">
        <h4>Capital y Aportes</h4>
        <p><strong>Monto de Capital:</strong> {{formularioSAC.paso_4.monto_capital | currency:'PEN ':'symbol':'1.2-2'}}</p>
        <p><strong>Aportes:</strong></p>
        <ul>
          <li *ngFor="let aporte of formularioSAC.paso_4.aportes">
            {{aporte.descripcion}} - {{aporte.monto | currency:'PEN ':'symbol':'1.2-2'}}
          </li>
        </ul>
      </div>
      
      <div class="summary-section">
        <h4>Datos del Apoderado</h4>
        <p><strong>Nombre del Apoderado:</strong> {{formularioSAC.paso_5.apoderado}}</p>
        <p><strong>DNI del Apoderado:</strong> {{formularioSAC.paso_5.dni_apoderado}}</p>
      </div>
      
      <div class="summary-section">
        <h4>Confirmación</h4>
        <p><strong>Ciudad:</strong> {{formularioSAC.paso_6.ciudad}}</p>
        <p><strong>Fecha de Registro:</strong> {{formularioSAC.paso_6.fecha_registro | date:'dd/MM/yyyy'}} </p>
      </div>
    </div>
    <div class="summary-actions">
      <button class="btn-edit" (click)="editarFormulario()">Editar</button>
      <button class="btn-confirm" (click)="enviarFormulario()">Enviar</button>
    </div>
  </div>
  
  <!-- Formulario de pago después de enviar -->
  <div *ngIf="formularioEnviado && !pagoConfirmado  && !pago2"  class="payment-form">
    <h3>Completar Pago</h3>
    <div class="payment-methods">
      <div class="payment-method" *ngFor="let metodo of metodosPago" 
          [ngClass]="{'selected': metodoPagoSeleccionado === metodo.id}"
          (click)="seleccionarMetodoPago(metodo.id)">
        <img [src]="metodo.imagen" [alt]="metodo.nombre">
        <span>{{metodo.nombre}}</span>
      </div>
    </div>
    <button class="btn-pay" [disabled]="!metodoPagoSeleccionado" (click)="confirmarPago()">
      Realizar Pago
    </button>
  </div>

    <!-- Mensaje de éxito después del pago -->
    <div *ngIf="pagoConfirmado || pago2" class="success-message">
      <div class="success-icon">✓</div>
      <h3>Felicitaciones</h3>
      <p>Tu empresa ({{nombreEmpresa}}) será registrada en un plazo no mayor a 10 días.</p>
      <p>Atento a tu correo, el notario te citará a firmar.</p>
    </div>
</div>